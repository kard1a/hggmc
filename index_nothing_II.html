<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roulette d'HGG</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=VT323&family=IBM+Plex+Mono:wght@300;400;500&family=IBM+Plex+Sans:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="sujets.js"></script>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOKENS & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:        #080808;
  --bg-card:   #111111;
  --bg-hover:  #181818;
  --border:    #222222;
  --border-mid:#333333;
  --text:      #e8e8e8;
  --text-dim:  #666666;
  --text-muted:#3a3a3a;
  --red:       #e8001d;
  --red-dim:   rgba(232,0,29,0.15);
  --green:     #00c853;
  --mono:      'VT323', monospace;
  --body-mono: 'IBM Plex Mono', monospace;
  --sans:      'IBM Plex Sans', sans-serif;
  --radius:    2px;
  --transition: 140ms cubic-bezier(.4,0,.2,1);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html { height: 100%; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--sans);
  font-weight: 300;
  font-size: 14px;
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCANLINE OVERLAY (Nothing texture)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.04) 2px,
    rgba(0,0,0,0.04) 4px
  );
  pointer-events: none;
  z-index: 9999;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#nav {
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 32px;
  height: 52px;
  border-bottom: 1px solid var(--border);
  background: rgba(8,8,8,0.95);
  backdrop-filter: blur(12px);
}

.nav-logo {
  font-family: var(--mono);
  font-size: 22px;
  letter-spacing: 4px;
  color: var(--text);
  user-select: none;
}

.nav-logo span {
  color: var(--red);
}

.nav-tabs {
  display: flex;
  gap: 0;
  border: 1px solid var(--border);
}

.nav-tab {
  padding: 8px 22px;
  font-family: var(--body-mono);
  font-size: 11px;
  font-weight: 500;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-dim);
  background: transparent;
  border: none;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
}

.nav-tab + .nav-tab {
  border-left: 1px solid var(--border);
}

.nav-tab.active {
  color: var(--text);
  background: var(--bg-card);
}

.nav-tab.active::after {
  content: '';
  position: absolute;
  bottom: -1px; left: 0; right: 0;
  height: 2px;
  background: var(--red);
}

.nav-tab:hover:not(.active) {
  color: var(--text);
  background: var(--bg-hover);
}

.nav-count {
  font-family: var(--body-mono);
  font-size: 11px;
  color: var(--text-dim);
  letter-spacing: 1px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIEWS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.view {
  display: none;
  padding-top: 52px;
  min-height: 100vh;
}

.view.active { display: block; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIEW 1 â€” ENTRAÃNEMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#view-train {
  display: none;
  flex-direction: column;
}

#view-train.active { display: flex; }

.train-layout {
  display: grid;
  grid-template-columns: 340px 1fr;
  min-height: calc(100vh - 52px);
}

/* LEFT PANEL â€” FILTERS */
.filter-panel {
  border-right: 1px solid var(--border);
  padding: 32px 24px;
  display: flex;
  flex-direction: column;
  gap: 28px;
  position: sticky;
  top: 52px;
  height: calc(100vh - 52px);
  overflow-y: auto;
}

.filter-panel::-webkit-scrollbar { width: 3px; }
.filter-panel::-webkit-scrollbar-thumb { background: var(--border-mid); }

.filter-section-title {
  font-family: var(--body-mono);
  font-size: 9px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 12px;
}

/* TYPE SELECTOR */
.type-selector {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.type-option {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 12px 14px;
  cursor: pointer;
  border: 1px solid transparent;
  border-radius: var(--radius);
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

.type-option:hover { background: var(--bg-hover); }

.type-option.active {
  background: var(--bg-card);
  border-color: var(--border-mid);
}

.type-option.active::before {
  content: '';
  position: absolute;
  left: 0; top: 0; bottom: 0;
  width: 2px;
  background: var(--red);
}

.type-icon {
  font-size: 18px;
  width: 24px;
  text-align: center;
  flex-shrink: 0;
}

.type-text { flex: 1; }

.type-name {
  font-family: var(--body-mono);
  font-size: 11px;
  font-weight: 500;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text);
}

.type-option.active .type-name { color: var(--red); }

.type-sub {
  font-family: var(--sans);
  font-size: 10px;
  font-style: italic;
  color: var(--text-dim);
  margin-top: 1px;
}

.type-count {
  font-family: var(--body-mono);
  font-size: 10px;
  color: var(--text-muted);
}

.type-option.active .type-count { color: var(--text-dim); }

/* TAG FILTERS */
.tag-group { margin-bottom: 4px; }

.tag-group-label {
  font-family: var(--body-mono);
  font-size: 8px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-muted);
  margin-bottom: 8px;
}

.tags-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.tag-btn {
  padding: 5px 10px;
  font-family: var(--body-mono);
  font-size: 10px;
  letter-spacing: 1px;
  color: var(--text-dim);
  background: transparent;
  border: 1px solid var(--border-mid);
  border-radius: var(--radius);
  cursor: pointer;
  transition: var(--transition);
  white-space: nowrap;
}

.tag-btn:hover {
  color: var(--text);
  border-color: var(--text-dim);
}

.tag-btn.active {
  color: var(--bg);
  background: var(--text);
  border-color: var(--text);
}

/* TOGGLE */
.toggle-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.toggle-label {
  font-family: var(--body-mono);
  font-size: 10px;
  letter-spacing: 1px;
  color: var(--text-dim);
}

.toggle-switch {
  position: relative;
  width: 36px;
  height: 18px;
  flex-shrink: 0;
  cursor: pointer;
}

.toggle-switch input { opacity: 0; width: 0; height: 0; position: absolute; }

.toggle-track {
  position: absolute;
  inset: 0;
  background: var(--border-mid);
  border-radius: 9px;
  transition: var(--transition);
}

.toggle-thumb {
  position: absolute;
  top: 3px; left: 3px;
  width: 12px; height: 12px;
  background: var(--text-dim);
  border-radius: 50%;
  transition: var(--transition);
}

.toggle-switch input:checked ~ .toggle-track { background: var(--red); }
.toggle-switch input:checked ~ .toggle-thumb {
  transform: translateX(18px);
  background: var(--text);
}

/* COUNTER */
.counter-display {
  text-align: center;
  padding: 16px 0;
  border-top: 1px solid var(--border);
}

.counter-num {
  font-family: var(--mono);
  font-size: 72px;
  line-height: 1;
  color: var(--text);
}

.counter-label {
  font-family: var(--body-mono);
  font-size: 9px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-top: 4px;
}

/* RIGHT PANEL â€” DRAW AREA */
.draw-panel {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px 64px;
  gap: 48px;
  min-height: calc(100vh - 52px);
}

.draw-zone {
  width: 100%;
  max-width: 680px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 32px;
}

/* RESULT DISPLAY */
.result-card {
  width: 100%;
  border: 1px solid var(--border-mid);
  background: var(--bg-card);
  padding: 28px 32px;
  min-height: 200px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  position: relative;
}

.result-type-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 3px 10px;
  border: 1px solid var(--border-mid);
  font-family: var(--body-mono);
  font-size: 9px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 14px;
  align-self: flex-start;
  opacity: 0;
  transition: opacity 0.3s;
}

.result-card.resolved .result-type-badge { opacity: 1; }

.result-type-badge.annales { border-color: #444; color: #888; }
.result-type-badge.colle { border-color: var(--red); color: var(--red); }
.result-type-badge.inedit { border-color: #00c853; color: #00c853; }

.result-topic {
  font-family: var(--sans);
  font-size: 20px;
  font-weight: 300;
  line-height: 1.4;
  color: var(--text);
  margin-bottom: 14px;
  min-height: 56px; 
}

.result-meta {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
}

.result-meta-item {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.result-meta-key {
  font-family: var(--body-mono);
  font-size: 8px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-muted);
}

.result-meta-val {
  font-family: var(--body-mono);
  font-size: 13px;
  color: var(--text-dim);
  min-width: 60px;
}

.result-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  min-height: 22px;
}

.result-tag {
  padding: 3px 8px;
  font-family: var(--body-mono);
  font-size: 9px;
  letter-spacing: 1px;
  color: var(--text-muted);
  border: 1px solid var(--border);
}

.scramble-dud {
  color: var(--red);
  opacity: 0.8;
}

/* DRAW BUTTON */
.draw-btn {
  position: relative;
  padding: 16px 48px;
  font-family: var(--body-mono);
  font-size: 13px;
  font-weight: 500;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--text);
  background: transparent;
  border: 1px solid var(--border-mid);
  cursor: pointer;
  transition: var(--transition);
  overflow: hidden;
}

.draw-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: var(--red);
  transform: translateX(-101%);
  transition: transform 200ms cubic-bezier(.4,0,.2,1);
}

.draw-btn:hover:not(:disabled)::before { transform: translateX(0); }
.draw-btn:hover:not(:disabled) { border-color: var(--red); }

.draw-btn span { position: relative; z-index: 1; }

.draw-btn:disabled {
  color: var(--text-muted);
  border-color: var(--border);
  cursor: not-allowed;
}

.draw-btn.glitching {
  border-color: var(--red);
  color: var(--red);
}

/* TIMER ZONE */
.timer-zone {
  display: none;
  width: 100%;
  max-width: 680px;
  flex-direction: column;
  align-items: center;
  gap: 24px;
}

.timer-zone.visible { display: flex; }

.timer-setup {
  display: flex;
  align-items: center;
  gap: 16px;
}

.timer-input-wrap {
  position: relative;
  display: flex;
  align-items: center;
}

.timer-input-label {
  font-family: var(--body-mono);
  font-size: 11px;
  letter-spacing: 1px;
  color: var(--text-dim);
  margin-right: 8px;
}

.timer-input {
  width: 64px;
  background: transparent;
  border: none;
  border-bottom: 1px solid var(--border-mid);
  color: var(--text);
  font-family: var(--mono);
  font-size: 28px;
  text-align: center;
  outline: none;
  padding: 2px 4px;
  transition: border-color var(--transition);
}

.timer-input:focus { border-bottom-color: var(--red); }
.timer-input::placeholder { color: var(--text-muted); }

.timer-input-suffix {
  font-family: var(--body-mono);
  font-size: 11px;
  color: var(--text-dim);
  margin-left: 6px;
}

.timer-start-btn {
  padding: 10px 24px;
  font-family: var(--body-mono);
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--bg);
  background: var(--text);
  border: 1px solid var(--text);
  cursor: pointer;
  transition: var(--transition);
}

.timer-start-btn:hover { background: var(--red); border-color: var(--red); }

.timer-start-btn.running {
  background: transparent;
  color: var(--red);
  border-color: var(--red);
}

.timer-stop-btn {
  padding: 10px 24px;
  font-family: var(--body-mono);
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-dim);
  background: transparent;
  border: 1px solid var(--border-mid);
  cursor: pointer;
  transition: var(--transition);
}

.timer-stop-btn:hover {
  color: var(--text);
  border-color: var(--text);
}

/* COUNTDOWN DISPLAY */
.countdown {
  font-family: var(--mono);
  font-size: 128px;
  line-height: 1;
  color: var(--text);
  letter-spacing: -4px;
  transition: color 500ms;
  user-select: none;
}

.countdown.urgent { color: var(--red); }

.countdown-bar-wrap {
  width: 100%;
  max-width: 480px;
  height: 2px;
  background: var(--border);
}

.countdown-bar {
  height: 100%;
  background: var(--red);
  transition: width 1s linear, background 500ms;
  width: 100%;
}

/* RESOURCES */
.resources-zone {
  display: none;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  width: 100%;
  max-width: 680px;
}

.resources-zone.visible { display: flex; }

.resources-label {
  font-family: var(--body-mono);
  font-size: 9px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--text-dim);
}

.resources-btns {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  justify-content: center;
}

.resource-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 20px;
  font-family: var(--body-mono);
  font-size: 11px;
  letter-spacing: 1px;
  color: var(--text-dim);
  background: var(--bg-card);
  border: 1px solid var(--border-mid);
  text-decoration: none;
  transition: var(--transition);
}

.resource-btn:hover {
  color: var(--text);
  border-color: var(--text-dim);
}

.resource-btn .resource-badge {
  padding: 2px 8px;
  background: var(--red);
  color: var(--text);
  font-size: 10px;
  font-weight: 400;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIEW 2 â€” STATISTIQUES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#view-stats {
  padding: 52px 0 0;
  display: none;
}

#view-stats.active { display: block; }

.stats-header {
  padding: 48px 64px 32px;
  border-bottom: 1px solid var(--border);
}

.stats-title {
  font-family: var(--mono);
  font-size: 48px;
  letter-spacing: 2px;
  color: var(--text);
  line-height: 1;
}

.stats-subtitle {
  font-family: var(--body-mono);
  font-size: 11px;
  letter-spacing: 2px;
  color: var(--text-dim);
  margin-top: 8px;
  text-transform: uppercase;
}

/* KPI STRIP */
.kpi-strip {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  border-bottom: 1px solid var(--border);
}

.kpi-item {
  padding: 28px 32px;
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.kpi-item:last-child { border-right: none; }

.kpi-value {
  font-family: var(--mono);
  font-size: 52px;
  line-height: 1;
  color: var(--text);
}

.kpi-label {
  font-family: var(--body-mono);
  font-size: 9px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-dim);
}

.kpi-sub {
  font-family: var(--sans);
  font-size: 11px;
  color: var(--text-muted);
  margin-top: 2px;
}

/* CHARTS GRID */
.charts-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: auto auto;
}

.chart-block {
  padding: 36px 40px;
  border-right: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
}

.chart-block:nth-child(2n) { border-right: none; }
.chart-block:nth-last-child(-n+2) { border-bottom: none; }

.chart-block-title {
  font-family: var(--body-mono);
  font-size: 9px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 6px;
}

.chart-block-sub {
  font-family: var(--sans);
  font-size: 12px;
  color: var(--text-muted);
  margin-bottom: 28px;
}

.chart-wrap {
  position: relative;
  height: 280px;
}

.chart-wrap.tall { height: 360px; }

/* DOUGHNUT LEGEND */
.doughnut-layout {
  display: flex;
  align-items: center;
  gap: 32px;
  height: 280px;
}

.doughnut-wrap {
  position: relative;
  width: 200px;
  height: 200px;
  flex-shrink: 0;
}

.doughnut-center {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  pointer-events: none;
}

.doughnut-center-num {
  font-family: var(--mono);
  font-size: 36px;
  color: var(--text);
}

.doughnut-center-label {
  font-family: var(--body-mono);
  font-size: 9px;
  letter-spacing: 1px;
  color: var(--text-dim);
}

.chart-legend {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
}

.legend-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.legend-name {
  font-family: var(--body-mono);
  font-size: 11px;
  color: var(--text-dim);
  flex: 1;
}

.legend-val {
  font-family: var(--mono);
  font-size: 18px;
  color: var(--text);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.divider {
  width: 100%;
  height: 1px;
  background: var(--border);
}

.fade-in {
  animation: fadeIn 300ms ease forwards;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50%       { opacity: 0.2; }
}

.blinking { animation: blink 800ms infinite; }

/* Scrollbar global */
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border-mid); }
</style>
</head>
<body>

<nav id="nav">
  <div class="nav-logo">HGG<span>MC</span></div>
  <div class="nav-tabs">
    <button class="nav-tab active" data-view="train">EntraÃ®nement</button>
    <button class="nav-tab" data-view="stats">Statistiques</button>
  </div>
  <div class="nav-count" id="nav-total">â€” sujets</div>
</nav>

<div id="view-train" class="view active">
  <div class="train-layout">

    <div class="filter-panel">

      <div>
        <div class="filter-section-title">Type de sujet</div>
        <div class="type-selector" id="type-selector">
          <div class="type-option active" data-type="TOUS">
            <div class="type-icon">â—ˆ</div>
            <div class="type-text">
              <div class="type-name">Tous</div>
              <div class="type-sub">Sans distinction</div>
            </div>
            <div class="type-count" id="count-tous">â€”</div>
          </div>
          <div class="type-option" data-type="Annales">
            <div class="type-icon">ğŸ“„</div>
            <div class="type-text">
              <div class="type-name">Annales</div>
              <div class="type-sub">Sujets tombÃ©s au concours</div>
            </div>
            <div class="type-count" id="count-annales">â€”</div>
          </div>
          <div class="type-option" data-type="Colle">
            <div class="type-icon">ğŸ™</div>
            <div class="type-text">
              <div class="type-name">Colle</div>
              <div class="type-sub">EntraÃ®nement oral</div>
            </div>
            <div class="type-count" id="count-colle">â€”</div>
          </div>
          <div class="type-option" data-type="InÃ©dit">
            <div class="type-icon">âœ¦</div>
            <div class="type-text">
              <div class="type-name">InÃ©dit</div>
              <div class="type-sub">Pourrait tomber</div>
            </div>
            <div class="type-count" id="count-inedit">â€”</div>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <div>
        <div class="filter-section-title">Aires gÃ©ographiques</div>
        <div class="tag-group">
          <div class="tags-grid" id="tags-geo">
            <button class="tag-btn" data-tag="AmÃ©riques">AmÃ©riques</button>
            <button class="tag-btn" data-tag="Asie">Asie</button>
            <button class="tag-btn" data-tag="Europe">Europe</button>
            <button class="tag-btn" data-tag="Afrique">Afrique</button>
            <button class="tag-btn" data-tag="Proche et Moyen-Orient">PMO</button>
            <button class="tag-btn" data-tag="France">France</button>
          </div>
        </div>
      </div>

      <div>
        <div class="filter-section-title">ThÃ©matiques</div>
        <div class="tags-grid" id="tags-theme">
          <button class="tag-btn" data-tag="Gouvernance & Puissance">Gouv. & Puissance</button>
          <button class="tag-btn" data-tag="Ã‰conomie & Croissance">Ã‰co. & Croissance</button>
          <button class="tag-btn" data-tag="Mondialisation & Acteurs">Mondialisation</button>
          <button class="tag-btn" data-tag="Enjeux durables">Enjeux durables</button>
        </div>
      </div>

      <div class="divider"></div>

      <div>
        <div class="filter-section-title">Ressources</div>
        <div class="toggle-row">
          <div class="toggle-label">Ressources corigÃ©es uniquement</div>
          <label class="toggle-switch">
            <input type="checkbox" id="toggle-resources">
            <div class="toggle-track"></div>
            <div class="toggle-thumb"></div>
          </label>
        </div>
      </div>

      <div class="divider"></div>

      <div class="counter-display">
        <div class="counter-num" id="counter-num">0</div>
        <div class="counter-label">Sujets disponibles</div>
      </div>

    </div>

    <div class="draw-panel">

      <div class="draw-zone">

        <div class="result-card" id="result-card">
          <div class="result-type-badge" id="result-badge">â€”</div>
          <div class="result-topic" id="result-topic">EN ATTENTE DU TIRAGE...</div>
          <div class="result-meta">
            <div class="result-meta-item">
              <div class="result-meta-key">Ã‰cole</div>
              <div class="result-meta-val" id="result-school">â€”</div>
            </div>
            <div class="result-meta-item">
              <div class="result-meta-key">AnnÃ©e</div>
              <div class="result-meta-val" id="result-year">â€”</div>
            </div>
          </div>
          <div class="result-tags" id="result-tags"></div>
        </div>

        <button class="draw-btn" id="draw-btn" disabled>
          <span id="draw-btn-text">Tirer un sujet</span>
        </button>

      </div>

      <div class="timer-zone" id="timer-zone">
        <div class="timer-setup">
          <div class="timer-input-label">DurÃ©e</div>
          <input class="timer-input" type="number" id="timer-input" placeholder="20" min="1" max="180">
          <div class="timer-input-suffix">min</div>
          <button class="timer-start-btn" id="timer-start-btn">START</button>
          <button class="timer-stop-btn" id="timer-stop-btn" style="display: none;">TERMINER</button>
        </div>
        <div class="countdown" id="countdown">â€”</div>
        <div class="countdown-bar-wrap">
          <div class="countdown-bar" id="countdown-bar"></div>
        </div>
      </div>

      <div class="resources-zone" id="resources-zone">
        <div class="resources-label">Ressources disponibles</div>
        <div class="resources-btns" id="resources-btns"></div>
      </div>

    </div>
  </div>
</div>

<div id="view-stats" class="view">

  <div class="stats-header">
    <div class="stats-title">ANALYSE</div>
    <div class="stats-subtitle">Base de donnÃ©es HGGMC â€” Vue d'ensemble</div>
  </div>

  <div class="kpi-strip">
    <div class="kpi-item">
      <div class="kpi-value" id="kpi-total">â€”</div>
      <div class="kpi-label">Sujets total</div>
      <div class="kpi-sub">dans la base</div>
    </div>
    <div class="kpi-item">
      <div class="kpi-value" id="kpi-rapport">â€”</div>
      <div class="kpi-label">Avec rapport</div>
      <div class="kpi-sub">rapport de jury</div>
    </div>
    <div class="kpi-item">
      <div class="kpi-value" id="kpi-copie">â€”</div>
      <div class="kpi-label">Avec bonne copie</div>
      <div class="kpi-sub">copie notÃ©e</div>
    </div>
    <div class="kpi-item">
      <div class="kpi-value" id="kpi-coverage">â€”</div>
      <div class="kpi-label">Taux de couverture</div>
      <div class="kpi-sub">au moins une ressource</div>
    </div>
  </div>

  <div class="charts-grid">

    <div class="chart-block">
      <div class="chart-block-title">RÃ©partition gÃ©ographique</div>
      <div class="chart-block-sub">Proportion de sujets par aire gÃ©ographique</div>
      <div class="doughnut-layout">
        <div class="doughnut-wrap">
          <canvas id="chart-geo"></canvas>
          <div class="doughnut-center">
            <div class="doughnut-center-num" id="geo-center-num">â€”</div>
            <div class="doughnut-center-label">sujets</div>
          </div>
        </div>
        <div class="chart-legend" id="legend-geo"></div>
      </div>
    </div>

    <div class="chart-block">
      <div class="chart-block-title">ThÃ©matiques</div>
      <div class="chart-block-sub">Volume de sujets par thÃ¨me dominant</div>
      <div class="chart-wrap">
        <canvas id="chart-themes"></canvas>
      </div>
    </div>

    <div class="chart-block">
      <div class="chart-block-title">FrÃ©quence par Ã©cole</div>
      <div class="chart-block-sub">Volume de sujets par Ã©tablissement</div>
      <div class="chart-wrap">
        <canvas id="chart-schools"></canvas>
      </div>
    </div>

    <div class="chart-block">
      <div class="chart-block-title">Couverture documentaire</div>
      <div class="chart-block-sub">Ratio de ressources disponibles par Ã©cole</div>
      <div class="chart-wrap">
        <canvas id="chart-coverage"></canvas>
      </div>
    </div>

  </div>
</div>

<script>
// --- ADAPTATION AU FICHIER ORIGINAL ---
if (typeof sujets !== 'undefined') {
  sujets.forEach(s => {
    if (!s.type) s.type = 'Annales';
  });
}
// --------------------------------------

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SCRAMBLE TEXT CLASS (Glitch Effect)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
class ScrambleText {
  constructor(el) {
    this.el = el;
    this.chars = '!<>-_\\\\/[]{}â€”=+*^?#_01';
    this.update = this.update.bind(this);
  }
  setText(newText) {
    const oldText = this.el.innerText;
    const length = Math.max(oldText.length, newText.length);
    const promise = new Promise(resolve => this.resolve = resolve);
    this.queue = [];
    for (let i = 0; i < length; i++) {
      const from = oldText[i] || '';
      const to = newText[i] || '';
      const start = Math.floor(Math.random() * 20);
      const end = start + Math.floor(Math.random() * 40);
      this.queue.push({ from, to, start, end });
    }
    cancelAnimationFrame(this.frameRequest);
    this.frame = 0;
    this.update();
    return promise;
  }
  update() {
    let output = '';
    let complete = 0;
    for (let i = 0, n = this.queue.length; i < n; i++) {
      let { from, to, start, end, char } = this.queue[i];
      if (this.frame >= end) {
        complete++;
        output += to;
      } else if (this.frame >= start) {
        if (!char || Math.random() < 0.28) {
          char = this.randomChar();
          this.queue[i].char = char;
        }
        output += `<span class="scramble-dud">${char}</span>`;
      } else {
        output += from;
      }
    }
    this.el.innerHTML = output;
    if (complete === this.queue.length) {
      this.resolve();
    } else {
      this.frameRequest = requestAnimationFrame(this.update);
      this.frame++;
    }
  }
  randomChar() {
    return this.chars[Math.floor(Math.random() * this.chars.length)];
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   STATE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const state = {
  selectedType:   'TOUS',
  activeTags:     new Set(),
  resourcesOnly:  false,
  filteredSujets: [],
  currentSujet:   null,
  timerInterval:  null,
  timerTotal:     0,
  timerRemaining: 0,
  timerRunning:   false,
  animating:      false,
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   FILTER ENGINE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getFiltered() {
  return sujets.filter(s => {
    if (state.selectedType !== 'TOUS' && s.type !== state.selectedType) return false;
    if (state.activeTags.size > 0) {
      for (const t of state.activeTags) {
        if (!s.tags.includes(t)) return false;
      }
    }
    if (state.resourcesOnly && !s.rapportLink && !s.copieLink) return false;
    return true;
  });
}

function getTypeCount(type) {
  const base = type === 'TOUS' ? sujets : sujets.filter(s => s.type === type);
  return base.filter(s => {
    if (state.activeTags.size > 0) {
      for (const t of state.activeTags) {
        if (!s.tags.includes(t)) return false;
      }
    }
    if (state.resourcesOnly && !s.rapportLink && !s.copieLink) return false;
    return true;
  }).length;
}

function updateFilters() {
  state.filteredSujets = getFiltered();
  const count = state.filteredSujets.length;

  document.getElementById('counter-num').textContent = count;
  document.getElementById('count-tous').textContent    = getTypeCount('TOUS');
  document.getElementById('count-annales').textContent = getTypeCount('Annales');
  document.getElementById('count-colle').textContent   = getTypeCount('Colle');
  document.getElementById('count-inedit').textContent  = getTypeCount('InÃ©dit');

  const drawBtn = document.getElementById('draw-btn');
  drawBtn.disabled = count === 0 || state.animating;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   GLITCH ANIMATION (TIRAGE)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const scramblerTopic = new ScrambleText(document.getElementById('result-topic'));
const scramblerSchool = new ScrambleText(document.getElementById('result-school'));
const scramblerYear = new ScrambleText(document.getElementById('result-year'));

function drawSubject() {
  if (state.filteredSujets.length === 0 || state.animating) return;
  state.animating = true;

  const drawBtn = document.getElementById('draw-btn');
  drawBtn.disabled = true;
  drawBtn.classList.add('glitching');
  document.getElementById('draw-btn-text').textContent = 'DÃ‰CRYPTAGE...';

  // RÃ©initialiser la zone
  clearTimer();
  document.getElementById('result-card').classList.remove('resolved');
  document.getElementById('timer-zone').classList.remove('visible');
  document.getElementById('resources-zone').classList.remove('visible');
  document.getElementById('result-tags').innerHTML = '';

  const pool = state.filteredSujets;
  const chosen = pool[Math.floor(Math.random() * pool.length)];
  state.currentSujet = chosen;

  // PrÃ©parer le badge cachÃ©
  const badge = document.getElementById('result-badge');
  badge.textContent = chosen.type || 'Annales';
  badge.className = 'result-type-badge';
  if (chosen.type === 'Annales') badge.classList.add('annales');
  else if (chosen.type === 'Colle') badge.classList.add('colle');
  else if (chosen.type === 'InÃ©dit') badge.classList.add('inedit');

  // Lancer le dÃ©cryptage (Glitch)
  Promise.all([
    scramblerTopic.setText(chosen.topic),
    scramblerSchool.setText(chosen.school || 'â€”'),
    scramblerYear.setText(chosen.year ? chosen.year.toString() : 'â€”')
  ]).then(() => {
    // Fin de l'animation
    document.getElementById('result-card').classList.add('resolved');
    
    // Afficher les tags
    const tagsEl = document.getElementById('result-tags');
    tagsEl.innerHTML = chosen.tags.map(t => `<span class="result-tag fade-in">${t}</span>`).join('');

    // Afficher le timer
    document.getElementById('timer-zone').classList.add('visible');
    document.getElementById('countdown').textContent = 'â€”';
    document.getElementById('countdown-bar').style.width = '100%';

    state.animating = false;
    drawBtn.disabled = false;
    drawBtn.classList.remove('glitching');
    document.getElementById('draw-btn-text').textContent = 'Nouveau tirage';
  });
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TIMER
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function formatTime(seconds) {
  const m = Math.floor(seconds / 60).toString().padStart(2, '0');
  const s = (seconds % 60).toString().padStart(2, '0');
  return `${m}:${s}`;
}

function startTimer() {
  const input = document.getElementById('timer-input');
  const minutes = parseInt(input.value) || 20;
  state.timerTotal     = minutes * 60;
  state.timerRemaining = state.timerTotal;
  state.timerRunning   = true;

  const btn = document.getElementById('timer-start-btn');
  btn.textContent = 'ANNULER';
  btn.classList.add('running');
  
  document.getElementById('timer-stop-btn').style.display = 'block';

  const countdownEl = document.getElementById('countdown');
  const barEl       = document.getElementById('countdown-bar');
  countdownEl.classList.remove('urgent', 'blinking');

  document.getElementById('resources-zone').classList.remove('visible');

  clearInterval(state.timerInterval);
  state.timerInterval = setInterval(() => {
    state.timerRemaining--;
    countdownEl.textContent = formatTime(state.timerRemaining);
    const pct = (state.timerRemaining / state.timerTotal) * 100;
    barEl.style.width = pct + '%';

    if (state.timerRemaining <= 30) {
      countdownEl.classList.add('urgent');
      barEl.style.background = 'var(--red)';
    }
    if (state.timerRemaining <= 10) {
      countdownEl.classList.add('blinking');
    }

    if (state.timerRemaining <= 0) {
      clearInterval(state.timerInterval);
      state.timerRunning = false;
      countdownEl.textContent = '00:00';
      countdownEl.classList.remove('blinking');
      btn.textContent = 'START';
      btn.classList.remove('running');
      document.getElementById('timer-stop-btn').style.display = 'none';
      showResources();
    }
  }, 1000);

  countdownEl.textContent = formatTime(state.timerRemaining);
}

function clearTimer() {
  clearInterval(state.timerInterval);
  state.timerRunning = false;
  const btn = document.getElementById('timer-start-btn');
  btn.textContent = 'START';
  btn.classList.remove('running');
  const countdownEl = document.getElementById('countdown');
  countdownEl.classList.remove('urgent', 'blinking');
  document.getElementById('timer-stop-btn').style.display = 'none';
}

function showResources() {
  const s = state.currentSujet;
  if (!s) return;
  if (!s.rapportLink && !s.copieLink) return;

  const zone = document.getElementById('resources-zone');
  const btns = document.getElementById('resources-btns');
  btns.innerHTML = '';

  if (s.rapportLink) {
    const a = document.createElement('a');
    a.href = s.rapportLink;
    a.target = '_blank';
    a.className = 'resource-btn';
    a.innerHTML = `<span>ğŸ“‹</span><span>Rapport du jury</span>`;
    btns.appendChild(a);
  }

  if (s.copieLink) {
    const a = document.createElement('a');
    a.href = s.copieLink;
    a.target = '_blank';
    a.className = 'resource-btn';
    let inner = `<span>ğŸ“</span><span>Bonne copie</span>`;
    if (s.copieNote) {
      inner += `<span class="resource-badge">${s.copieNote}</span>`;
    }
    a.innerHTML = inner;
    btns.appendChild(a);
  }

  zone.classList.add('visible', 'fade-in');
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   NAVIGATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function switchView(viewId) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('view-' + viewId).classList.add('active');
  document.querySelector(`[data-view="${viewId}"]`).classList.add('active');

  if (viewId === 'stats') initCharts();
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   STATS â€” CHART.JS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let chartsInited = false;
const chartInstances = {};

const GEO_COLORS = ['#e8001d','#c8c8c8','#888888','#555555','#333333','#1a1a1a'];

function initCharts() {
  if (chartsInited) return;
  chartsInited = true;

  const total = sujets.length;
  document.getElementById('kpi-total').textContent = total;

  const withRapport = sujets.filter(s => s.rapportLink).length;
  const withCopie   = sujets.filter(s => s.copieLink).length;
  const withAny     = sujets.filter(s => s.rapportLink || s.copieLink).length;

  document.getElementById('kpi-rapport').textContent  = withRapport;
  document.getElementById('kpi-copie').textContent    = withCopie;
  document.getElementById('kpi-coverage').textContent = Math.round((withAny / total) * 100) + '%';
  document.getElementById('geo-center-num').textContent = total;
  document.getElementById('nav-total').textContent = total + ' sujets';

  // â”€â”€ GEO DOUGHNUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const geoTags  = ['AmÃ©riques','Asie','Europe','Afrique','Proche et Moyen-Orient','France'];
  const geoCounts = geoTags.map(tag => sujets.filter(s => s.tags.includes(tag)).length);

  const ctxGeo = document.getElementById('chart-geo');
  chartInstances.geo = new Chart(ctxGeo, {
    type: 'doughnut',
    data: {
      labels: geoTags,
      datasets: [{
        data: geoCounts,
        backgroundColor: GEO_COLORS,
        borderColor:     '#080808',
        borderWidth:     3,
        hoverBorderColor:'#080808',
        hoverBorderWidth: 3,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '68%',
      plugins: { legend: { display: false }, tooltip: { ...tooltipStyle() } },
    }
  });

  const legendEl = document.getElementById('legend-geo');
  geoTags.forEach((tag, i) => {
    const pct = Math.round((geoCounts[i] / total) * 100);
    const item = document.createElement('div');
    item.className = 'legend-item';
    item.innerHTML = `
      <div class="legend-dot" style="background:${GEO_COLORS[i]}"></div>
      <div class="legend-name">${tag === 'Proche et Moyen-Orient' ? 'PMO' : tag}</div>
      <div class="legend-val">${geoCounts[i]}</div>`;
    legendEl.appendChild(item);
  });

  // â”€â”€ THEMES BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const themes = ['Gouvernance & Puissance','Ã‰conomie & Croissance','Mondialisation & Acteurs','Enjeux durables'];
  const themeCounts = themes.map(t => sujets.filter(s => s.tags.includes(t)).length);
  const themeShort  = ['Gouv. & Puissance','Ã‰co. & Croissance','Mondialisation','Enjeux durables'];

  const ctxThemes = document.getElementById('chart-themes');
  chartInstances.themes = new Chart(ctxThemes, {
    type: 'bar',
    data: {
      labels: themeShort,
      datasets: [{
        data: themeCounts,
        backgroundColor: ['#e8001d','#888','#555','#333'],
        borderWidth: 0,
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false }, tooltip: { ...tooltipStyle() } },
      scales: {
        x: { ...scaleStyle(), grid: { color: '#1a1a1a' } },
        y: { ...scaleStyle(), grid: { display: false } },
      }
    }
  });

  // â”€â”€ SCHOOLS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const schoolCounts = {};
  sujets.forEach(s => { schoolCounts[s.school] = (schoolCounts[s.school] || 0) + 1; });
  const schoolEntries = Object.entries(schoolCounts).sort((a,b) => b[1]-a[1]);
  const schoolLabels  = schoolEntries.map(e => e[0]);
  const schoolVals    = schoolEntries.map(e => e[1]);

  const ctxSchools = document.getElementById('chart-schools');
  chartInstances.schools = new Chart(ctxSchools, {
    type: 'bar',
    data: {
      labels: schoolLabels,
      datasets: [{
        data: schoolVals,
        backgroundColor: schoolLabels.map((_, i) => i === 0 ? '#e8001d' : '#333'),
        borderWidth: 0,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false }, tooltip: { ...tooltipStyle() } },
      scales: {
        x: { ...scaleStyle(), grid: { display: false } },
        y: { ...scaleStyle(), grid: { color: '#1a1a1a' } },
      }
    }
  });

  // â”€â”€ COVERAGE RADAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const topSchools = schoolEntries.slice(0, 6).map(e => e[0]);
  const coverageData = topSchools.map(school => {
    const total  = sujets.filter(s => s.school === school).length;
    const withRes = sujets.filter(s => s.school === school && (s.rapportLink || s.copieLink)).length;
    return total > 0 ? Math.round((withRes / total) * 100) : 0;
  });

  const ctxCoverage = document.getElementById('chart-coverage');
  chartInstances.coverage = new Chart(ctxCoverage, {
    type: 'radar',
    data: {
      labels: topSchools,
      datasets: [{
        label: 'Couverture (%)',
        data: coverageData,
        backgroundColor: 'rgba(232,0,29,0.1)',
        borderColor: 'var(--red)',
        borderWidth: 1,
        pointBackgroundColor: 'var(--red)',
        pointRadius: 3,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false }, tooltip: { ...tooltipStyle() } },
      scales: {
        r: {
          min: 0, max: 100,
          ticks: {
            color: '#333',
            backdropColor: 'transparent',
            font: { family: 'IBM Plex Mono', size: 9 },
            stepSize: 25,
          },
          grid:       { color: '#1a1a1a' },
          angleLines: { color: '#1a1a1a' },
          pointLabels: {
            color: '#666',
            font: { family: 'IBM Plex Mono', size: 10 }
          }
        }
      }
    }
  });
}

function tooltipStyle() {
  return {
    backgroundColor: '#111',
    borderColor: '#333',
    borderWidth: 1,
    titleColor: '#e8e8e8',
    bodyColor: '#888',
    titleFont: { family: 'IBM Plex Mono', size: 11 },
    bodyFont:  { family: 'IBM Plex Mono', size: 10 },
    padding: 10,
  };
}

function scaleStyle() {
  return {
    ticks: { color: '#555', font: { family: 'IBM Plex Mono', size: 10 } },
    border: { color: '#222' },
  };
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   INIT & EVENT LISTENERS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function init() {
  document.getElementById('nav-total').textContent = sujets.length + ' sujets';

  updateFilters();

  document.querySelectorAll('.nav-tab').forEach(btn => {
    btn.addEventListener('click', () => switchView(btn.dataset.view));
  });

  document.querySelectorAll('.type-option').forEach(opt => {
    opt.addEventListener('click', () => {
      document.querySelectorAll('.type-option').forEach(o => o.classList.remove('active'));
      opt.classList.add('active');
      state.selectedType = opt.dataset.type;
      updateFilters();
    });
  });

  document.querySelectorAll('.tag-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tag = btn.dataset.tag;
      if (state.activeTags.has(tag)) {
        state.activeTags.delete(tag);
        btn.classList.remove('active');
      } else {
        state.activeTags.add(tag);
        btn.classList.add('active');
      }
      updateFilters();
    });
  });

  document.getElementById('toggle-resources').addEventListener('change', e => {
    state.resourcesOnly = e.target.checked;
    updateFilters();
  });

  document.getElementById('draw-btn').addEventListener('click', drawSubject);

  document.getElementById('timer-start-btn').addEventListener('click', () => {
    if (state.timerRunning) {
      clearTimer();
      document.getElementById('countdown').textContent = 'â€”';
    } else {
      startTimer();
    }
  });

  document.getElementById('timer-stop-btn').addEventListener('click', () => {
    clearTimer();
    document.getElementById('countdown').textContent = '00:00';
    document.getElementById('countdown-bar').style.width = '0%';
    showResources();
  });
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>